# Dockerfile.dev

# ===================================================
# 1단계: 빌더 이미지 (Builder Stage)
# ===================================================
FROM node:20-alpine AS builder

# ARG 선언: 외부 (docker-compose)에서 MYSQL_URI 값을 받기 위해 선언
ARG MYSQL_URI

WORKDIR /app
COPY package.json package-lock.json ./
RUN npm install

# ARG로 받은 MYSQL_URI 값을 환경 변수로 설정합니다.
# 이 ENV는 이후 'RUN npm run build' 명령이 실행될 때 사용됩니다.
ENV MYSQL_URI=${MYSQL_URI}

COPY . .

# ===================================================
# 2단계: 실행 스테이지 (Runner Stage - Dev 모드)
# ===================================================
FROM node:20-alpine
WORKDIR /app

# ENV 설정
ENV NODE_ENV development
ENV PORT 3000

# Next.js 개발 환경은 전체 node_modules와 소스 코드가 필요합니다.
# 핫 리로드를 위해 볼륨 마운트 시, 이 코드는 필요하지만
# 2단계 이미지에서는 소스 코드를 복사하는 것이 안전합니다.
# 개발 모드는 로컬 볼륨 마운트가 주도하므로, 간단하게만 복사합니다.

# 빌더 단계에서 모든 파일 복사 (개발 모드이므로 전체 복사)
COPY --from=builder /app /app

EXPOSE 3000

# 개발 모드 (Watch 모드)로 시작
CMD ["npm", "run", "dev"]